angular.module('beamng.apps')
  .directive('simpleElectrics', ['bngApi', 'StreamsManager', 'UiUnits', function (bngApi, StreamsManager, UiUnits) {
    return {
      template:
      `<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" id="svg8"><g id="layer1"><g style="line-height:1.25" id="text5074" font-size="10.583" font-family="sans-serif" letter-spacing="0" word-spacing="0" fill="transparent" stroke-width=".265"><path d="M13.39 17.337l-1.738.596L9.42 19.52l-3.638 5.8-.627 2.34v5.774l.505.874v4.255l.83.83h4.144l.72-.718v-1.688h15.931v1.688l.72.72h4.143l.83-.832v-4.255l.505-.874V27.66l-.627-2.34-3.637-5.8-2.23-1.587-1.738-.596H18.503zm2.926 3.325H22.324l2.283.248 1.737.496.893 1.24.25.93H11.153l.25-.93.892-1.24 1.737-.496zm-6.153 5.458H28.476l.372.372-1.68.194-1.425.824-.412 1.395.898 1.298H29.918l.34.34-.39.39H8.774l-.39-.39.34-.34h3.685l.898-1.298-.413-1.395-1.426-.824-1.68-.194zm4.863.793l-.368 1.822v1.355h9.326v-1.355l-.368-1.822H18.75zm-6.053 6.105H29.67v.943l-1.374.37H10.348l-1.374-.37zm6.293 7.463l-9.11.044-1.186.34.254.677 1.06.806 1.525.085h2.33s2.457.085 2.626.085c.17 0 1.864.17 1.864.17l.51.296-.213.383-1.526.423-1.312.17-3.77.212-2.035.296-2.245.34-1.567.423-1.1.678-.552.89.466 1.058.89 1.017 2.076.72 2.542.552s2.796.254 3.05.254c.255 0 2.5-.085 2.67-.128.17-.042 1.694-.296 1.694-.296l.933-.34.083-.677-.678-.593-1.906-.297-3.475-.042-4.025-.254-.678-.34.042-.424 1.695-.254 5.168-.635 5.253-.975 2.078-.72.678-1.102-.55-1.356-1.4-.89zm16.076 0l-9.11.044-1.185.34.254.677 1.06.806 1.526.085h2.33s2.457.085 2.627.085c.17 0 1.864.17 1.864.17l.508.296-.21.383-1.527.423-1.313.17-3.77.212-2.035.296-2.245.34-1.568.423-1.102.678-.55.89.466 1.058.89 1.017 2.077.72 2.542.552s2.795.254 3.05.254c.254 0 2.5-.085 2.668-.128.17-.042 1.695-.296 1.695-.296l.932-.34.085-.677-.678-.593-1.906-.297-3.475-.042-4.024-.254-.677-.34.04-.424 1.696-.254 5.17-.635 5.252-.975 2.076-.72.678-1.102-.55-1.356-1.4-.89z" id="svgESC" stroke-width=".085"/><path d="M45.76 17.337l-1.736.596-2.233 1.588-3.636 5.8-.627 2.34v5.774l.505.874v4.255l.83.83h4.145l.72-.718v-1.688h15.932v1.688l.72.72h4.143l.832-.832v-4.255l.505-.874V27.66l-.627-2.34-3.636-5.8-2.233-1.587-1.736-.596h-6.75zm2.928 3.325h6.007l2.282.248 1.737.496.894 1.24.248.93h-16.33l.25-.93.892-1.24 1.735-.496zm-6.153 5.458H60.85l.37.372-1.676.194-1.427.824-.413 1.395.9 1.298h3.684l.34.34-.39.39H41.147l-.39-.39.34-.34h3.685l.9-1.298-.412-1.395-1.427-.824-1.677-.194zm4.863.793l-.368 1.822v1.355h9.324v-1.355l-.368-1.822h-4.862zm-6.054 6.105H62.04v.943l-1.374.37H42.72l-1.374-.37zm-2.13 7.405v8.472h3.72v-8.472zm21.46 0v8.472h3.72v-8.472z" id="svgTC" stroke-width=".099"/></g></g></svg>`,
      replace: true,
      link:
      function (scope, element, attrs) {
        var streamsList = ['electrics'];
        StreamsManager.add(streamsList);
        var svg = element[0];

        var colourMap = {
          0: "transparent",
          1: "#FF9600",
        }

        scope.$on('streamsUpdate', function (event, data) {

          if (data.electrics != null) {
            if (data.electrics.esc != null || data.electrics.tcs != null) {
              hu("#svgESC", svg).attr({
                fill: colourMap[data.electrics.esc],
              })

              hu("#svgTC", svg).attr({
                fill: colourMap[data.electrics.tcs],
              })
            }
            else {
              return;
            }
          }
          else {
            return;
          }

        });

        scope.$on('$destroy', function () {
          StreamsManager.remove(streamsList);
        });

        scope.$on('app:resized', function (event, data) {
          svg.setAttribute('viewBox', [0, 0, "70", "70"]);
        });
      }
    };
  }])
